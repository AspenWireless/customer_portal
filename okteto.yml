build:
  base:
    context: .
  customer-portal:
    context: .
    dockerfile: okteto.Dockerfile
    depends_on:
      - base

deploy:
  compose: docker-compose.yml

dev:
  customer-portal:
    securityContext:
      runAsUser: 33
      runAsGroup: 33
      fsGroup: 33
    resources:
      limits:
        cpu: 2
        memory: 4Gi
    sync:
      - .:/var/www/html/
    workdir: /var/www/html/
    remote: 22223
    reverse:
      - 23517:23517 # spatie/ray
    command: bash /var/www/html/okteto.sh
    environment:
      - APP_ENV=local
      - APP_DEBUG=true
      - APP_KEY=base64:7qBm4Fss5HEZQu+lJHyh9+j0AQl7es/mg2aPIuk1rLo=
      - API_USERNAME=admin
      - API_PASSWORD=sonar
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - NGINX_HOST=customer-portal-${OKTETO_NAMESPACE}.${OKTETO_DOMAIN}
      - SONAR_URL=http://web-${OKTETO_NAMESPACE}.${OKTETO_DOMAIN}:8080
      - OKTETO_SONAR_HOST=web-${OKTETO_NAMESPACE}.${OKTETO_DOMAIN}
